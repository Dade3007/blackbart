<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="./blackbart-main-page.html">
<link rel="import" href="./blackbart-product-page.html">
<link href="https://fonts.googleapis.com/css?family=Sacramento" rel="stylesheet">
<dom-module id="blackbart-app">
    <template>
        <style>
        :host {
            /* --primary-color: #775D94; */
            --primary-color: purple;
            --blackbart-main-button: {
                border: 2px solid purple;
                color: purple;
                font-weight: bold;
            }
            --blackbart-second-button: {
                border: 2px solid purple;
                color: white;
                font-weight: bold;
                background-color: purple;
            }
        }

        paper-header-panel {
            --paper-header-panel-shadow: {
                height: 0px;
                bottom: 0px;
                box-shadow: inset 0px 0px 6px 0px rgba(0, 0, 0, 0.4);
            }
        }

        #mainContent {
            margin: 0 auto;
            max-width: 1440px;
            height: auto;
        }

        paper-item iron-icon {
            margin-right: 10px;
        }

        #drawerHeader {
            background-color: var(--primary-color);
            color: white;
            font-family: 'Sacramento';
            font-size: 35px;
            padding-top: 7px;
        }

        a {
            color: inherit;
            /* blue colors for links too */
            text-decoration: inherit;
            /* no underline */
        }

        </style>
        <app-location route="{{route}}" use-hash-as-path></app-location>
        <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}">
        </app-route>
        <paper-drawer-panel force-narrow id="drawer">
            <paper-header-panel drawer>
                <iron-selecton>
                    <paper-item id="drawerHeader">Canela</paper-item>
                    <paper-item data-page="home" on-tap="changeTab" sectionid="0">
                        <iron-icon icon="icons:home"></iron-icon>Home
                    </paper-item>
                    <template is="dom-repeat" items="{{sections}}">
                        <paper-item data-page$="{{item.name}}" on-tap="changeTab" sectionid$="{{item.id}}">{{item.name}}</paper-item>
                    </template>
                    </iron-selector>
            </paper-header-panel>
            <paper-header-panel main>
                <template is="dom-if" if="{{sections}}">
                    <blackbart-header sections="{{sections}}" selected="{{tabSelected}}"></blackbart-header>
                    <div id="mainContent">
                        <iron-pages id="scaffolder" selected="{{pageSelected}}">
                            <blackbart-main-page current-page="{{mainSelected}}"></blackbart-main-page>
                            <blackbart-product-page></blackbart-product-page>
                            <div>page2</div>
                        </iron-pages>
                    </div>
                </template>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>
    <script>
    Polymer({

        is: 'blackbart-app',
        listeners: {
            'go-to-page': 'changePage',
            "add-to-cart": "_addToCart",
            "go-to": "goTo",
            "tab-change": "changeTab",
            "toggle-menu": "toggleMenu",
            "go-home": "goHome"
        },
        observers: [
            "_routeChange(routeData)"
        ],
        properties: {

            mainSelected: {
                type: Number,
                value: 0,
                notify: true
            },
            currentPage: {
                type: Number,
                value: 0
            },
            sections: {
                type: Array,
                notify: true
            },
            pageSelected: {
                type: Number,
                value: 0
            },
            cart: {
                type: Object
            }
        },

        created: function() {
            var config = {
                apiKey: "AIzaSyCnLEqrZMYzJQnyHpr2zZoXT1m4izLxUm8",
                authDomain: "blackbart-38833.firebaseapp.com",
                databaseURL: "https://blackbart-38833.firebaseio.com",
                storageBucket: "blackbart-38833.appspot.com",
                messagingSenderId: "36667056686"
            };
            firebase.initializeApp(config);

            var self = this;

            var sections = firebase.database().ref('/section');
            sections.on('value', function(snapshot) {
                self.sections = snapshot.val();
            });

        },

        attached: function() {
            if (!this.route.path) {
                this.set('route.path', '/home');
            }
        },

        goTo: function(event, detail) {
            this.set('route.path', '/section');
            this.tabSelected = detail.sectionId - 1;
            this.mainSelected = detail.sectionId;
        },
        goHome: function() {
            //this.pageSelected = 0;
            //this.mainSelected = 0;
            this.set('route.path', '/home');
        },
        _addToCart: function() {
            console.log('addToCart');
        },

        _routeChange: function(data) {
            var page = data.page;
            if (page !== undefined){
                switch(page){
                    case "home":
                        this.pageSelected = 0;
                        this.mainSelected = 0;
                    break;
                    case "section":
                        this.pageSelected = 0;
                       // this.tabSelected = detail.sectionId - 1;
                       // this.mainSelected = detail.sectionId;
                    break;
                    case "product":
                        this.pageSelected = 1;
                    break;
                    default:
                    break;
                }
            }
            console.log(data.page)
        },

        changePage: function(event, detail) {
            this.set('route.path', '/' + detail.routeName);
            this.pageSelected = detail.page;
        },


        changeTab: function(event, detail) {
            this.pageSelected = 0;
            detail.tabSelected == undefined ? this.mainSelected = event.target.getAttribute('sectionid') : this.mainSelected = detail.tabSelected + 1;

            this.$.drawer.closeDrawer()
        },

        toggleMenu: function() {
            if (window.innerWidth <= 480) {
                this.$.drawer.togglePanel()
            }
        },
    });
    </script>
</dom-module>
